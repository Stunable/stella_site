{% extends "retailers/retailer_base.html" %}

{% block title %} Stunable | Stylist Administration {% endblock %}

{% block body_class %}common large_common pad-bottom{% endblock %}
{% block content-class%}round-corner-shadow{%endblock%}

{% block content %}

<style type="text/css">
	.account #page-content {
		margin-top: 0px;
	}
	select {
	    display: inline;
	}
	input {
		display: block;
	  }
	  .inner-table td{
	      width: 20%;
	  }
    .big.red{
        font-size:1.4em;
    }
    .small{
        font-size:.9em;
    }
    .product_list_table th,td{
        text-align: center;
        font-weight: lighter;
    }
    .notconfirm .nodeets .variation{
        display: none;
        border-bottom:none;
    }
    .item_pic{
        display:none;
    }
    .nodeets .item_pic{
        display:block;
    }

    .confirm .deetsclick{
        display:none;
    }

    .notconfirm .deetsclick{
        color:#EC67F0;
        cursor:pointer;
    }

    .product_list_table th,td.heading{
        font-weight: 600;
        font-size:.8em;
        color:#777;
    }
    .product_list_table td.saleprice{
        color:red;
    }
    .product_list_table td.warning{
        color:orange;
    }
    .product_list_table td.inventory0{
        color:red;
    }
    .product_list_table .action-checkbox{
        text-align: center;
    }
    .product_list_table .action-checkbox {
        /*text-align: center;*/
        font-size: .8em;
    }
    .product_list_table .action-checkbox input{
        /*text-align: center;*/
        margin-left:40%;
    }
    .product_list_table .action-checkbox>div{
        margin-top:16px;
        cursor:pointer;
    }

    #bulk_add_box{
        padding:8px;
        border-radius:5px;
        border:1px solid #ccc;
        width:300px;
 /*       float:right;*/
        margin:10px;
        position:relative;
        font-size:15px;
        height:420px;
    }

    #bulk_add_box.collapsed{
        height:30px;
        overflow:hidden;
        width:180px;
        border:none;
        padding:0px;
    }

    #addbuttons div{
        margin:20px;
    }

    #id_uploaded_zip{
        font-size:.5em;
        text-align: left;
        border: 1px dashed #EC67F0;
        border-radius:8px;
        width:160px;
        height:60px;
        position:absolute;
        padding:10px;
        top:330px;
        left:20px;

    }



</style>

<div class="section intro clearfix">
    <h2><span>{% if upload %}Upload: {{upload.filename}}{% else %}Product Inventory{% endif %}</span></h2><h3><span>{{ retailer_profile.name }}</span></h3>
</div>
<div class="section body-copy bootstrap {% if not confirm %}not{% endif %}confirm">
    
    {% if action %}
    <form class="action_submit" action="/retailers/item_action?next={% url product_list %}" method="post">
        <p> Are you sure you want to delete the following items?</p>
        <input type="hidden" name="confirm_{{confirm.action_name}}" value="True">
        <input type="hidden" name="action_name" value="{{confirm.action_name}}">
    {% else %}
    {% if upload %}
        <p>
            Here are the results of your upload.
            {% if upload.uploaderror_set.all|length %}
            <p> Looks like there were a few issues:</p>
            <div style="margin-left:25px;background-color:#eee;padding:5px">
                {% for error in upload.uploaderror_set.all %}
                    <p>{{error|safe}}</p>
                {% endfor %}
            {% endif %}
            </div>
  
            <p>If you're having trouble with any part of the product upload process, just <a href="mailto:stylists@stunable.com?subject=Upload Trouble ({{upload.id}})">email us</a> at stylists@stunable.com and we'll help you out.</p>

        </p>
    {% endif %}
    {% if bulk_upload_form %}
    <div>

    <div id="addbuttons">
        <div><a href="{% url add_item %}"type="button" class="btn">Add Item</a></div>
        <div id="bulk_add_box" class="collapsed">
            <a href="" type="button" class="btn click_to_expand">Add Lots of Items</a>
            <p style="margin:10px">If you have lots of items to sell, and would like to upload them in large batches,  just follow these two steps:<br><br>
                1.&nbsp <a href="{{ STATIC_URL }}stunable_upload_example.zip" target="blank"><strong class="big red">download this example file </strong></a> <br><br>

                2.&nbsp unzip it, put your own files and information in it, and send it back right here.

                  <p>Uploads need to be <strong>.zip</strong> files with a .XLS file and then an image for each item.  Upload it here and you'll know what to do next.  Email us if you have questions</p>
            <form style="float:right" action="/retailers/item/bulk_upload/" method="POST"enctype="multipart/form-data">
                {{bulk_upload_form.as_p}}
                {{bulk_upload_form.errors}}
                {% csrf_token %}
            <input type="submit" value="Submit">
            </form>    
        </div>
    </div>
    <br><br>
    {% endif %}
    <form class="action_submit" action="/retailers/item_action?next={% url product_list %}" method="post">
        {% if not confirm %}
        <select style="display:none" id="action_select" name="action_name">
            <option value="-------------">-------------</option>
            <option name="action" value="delete">Delete Selected</option>
        </select>
        <input style="display:none;margin-right:20px;margin-bottom:5px" type="submit" value="Go">
        {% endif %}

    {% endif %}
    {% csrf_token %}
    <table class="product_list_table">
        <tbody>
            {% if not confirm %}
            <!-- This is the "select all" action-checkbox -->
            <tr>
                <td>
                    <input class="select_all" data-target=".item_selector" type="checkbox">
                </td>
                <td>
                    select all
                </td>
                <td colspan=5>
                </td>
            </tr>
            {% endif %}
            {% for item in product_list %}
            <tr class="product_row nodeets">
            {% if confirm %}
                <input type="hidden" value="{{item.pk}}" name="selected_items">
                {% else %}
                <td class="action-checkbox"><input class="item_selector" type="checkbox" value="{{item.pk}}" name="selected_items">
                    <div><a class="edit-link" href="{% url edit_item item.pk %}">Edit</a></div>
                    <div><a class="delete-link">Delete</a></div>
                </td>
            {% endif %}
                <td >
                    {% load thumbnail %}
                    {% thumbnail item.get_image "50" as im %}
                        <img class="item_pic" src="{{ im.url }}">
                        {% empty %}
                        <img class="item_pic" src="{{ item.get_image }}" style="width: 50px;" alt=""/>
                    {% endthumbnail %}
                    
                </td>
                <td>
                    <table class="inner-table">
                        <thead>
                            <th>PRODUCT NAME</th>
                            <th>RETAIL PRICE RANGE</th>
                            <th class="small">TOTAL INVENTORY</th>
                            <th>STATUS</th>
                            <th>DATE ADDED</th>
                        </thead>

                        <tbody>
                            <tr>
                                <td>{{item.name|lower}}</td>
                                <td>${{item.price_range.min}}{% if not item.price_range.max == item.price_range.min %} - ${{item.price_range.max}}{%endif%}</td>
                                <td {% if not item.all_inv_in_stock %}class="warning"{% endif %}>{{item.total_inventory}}</td>
                                <td>{{item.display_approval_status|safe|lower}}</td>
                                <td>{{item.created_date}}</td>
                            </tr>
                            {% if not confirm %}
                            <tr class="deetsclick"><td colspan=5>Click to Show/Hide Details</td></tr>
                            {% endif %}
                            {% with item.types_by_color as styles %}
                                {% for it in styles.styles %} 
                                <tr class="variation">
                                    <td><img class="var_pic" src="{% thumbnail it.list.0.pic "50" as im %}{{im.url}}{% endthumbnail %}"></td>
                                    <td colspan=4>
                                        <table>
                                            <tr><td class="heading">COLOR</td>
                                                <td colspan={{styles.longest}}>{{it.color|lower}}</td>
                                            </tr>
                                            <tr>
                                                <td class="heading">SIZE</td>{% for s in it.list %}<td>{{s.size|lower}}</td>{% endfor %}
                                            </tr>
                                            <tr>
                                                <td class="heading">QUANTITY AVAILABLE</td>{% for s in it.list %}<td class="inventory{{ s.inv }}">{{s.inv|lower}}</td>{% endfor %}
                                            </tr>
                                            <tr>
                                                <td class="heading">PRICE</td>{% for s in it.list %}<td>${{s.price|lower}}{% if s.onsale %}<sup>*</sup>{% endif %}</td>{% endfor %}
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                                {% endfor %}
                            {% endwith %}
                        </tbody>
                    </table>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% if confirm %}
   
        {% if action %}
        <a href="{% url product_list %}"><input type="button" value="Cancel"></a>
        <input style="display:inline;margin-right:20px;margin-top:15px" type="submit" value="Yes. I'm sure.">
        {% endif %}
    {% endif %}
{% if action or confirm %}
</form>
{% endif %}
</div>
{% endblock %}

